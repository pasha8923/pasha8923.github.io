<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Подбор кода ТН ВЭД — ВЭД Суппорт</title>
  <meta name="description" content="Подбор предполагаемого кода ТН ВЭД по краткому описанию товара." />
  <link rel="stylesheet" href="styles.css?v=4" />
  <link rel="icon" type="image/png" href="assets/logo.png" />
  <link rel="apple-touch-icon" href="assets/logo.png" />
<style>
@keyframes spinLogo {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.logo-loading {
  animation: spinLogo 1.2s linear infinite;
}
</style>
</head>

<body class="page-inner page-tnved">
  <header class="header">
    <div class="container header__inner">
      <nav class="nav" aria-label="Навигация">
  <a href="./services.html">Услуги</a>
  <a href="./about.html">Опыт</a>
  <a href="./question.html">Задать вопрос</a>
  <a href="./tnved.html">Подбор кода ТНВЭД</a>
  <a href="./contact.html">Контакты</a>

  <a class="navLogo" href="./index.html" aria-label="На главную">
    <img id="mainLogo" src="assets/logo.png" alt="ВЭД Суппорт">
  </a>
</nav>
    </div>
  </header>

  <main class="hero">
    <div class="container">
      <div class="hero__panel">
        <div class="hero__inner">
          <div>
            <div class="kicker"><span class="kicker__dot"></span> Онлайн-инструмент </div>
            <h1 class="h1">Подбор кода ТН ВЭД</h1>
            <p class="lead">
              Введите краткое описание товара — получите предполагаемый код ТНВЭД и список уточняющих вопросов.
            </p>

            <div class="card card--big" style="margin-top: 14px;">
              <form class="form" id="tnvedForm">
                <div class="field">
  <div class="label">Введите краткое описание товара и вставьте изображение из буфера обмена</div>
  <textarea
    id="goodsText"
    placeholder="Например: 'Футболка мужская, 100% хлопок, трикотаж'"
  ></textarea>

  <div id="imgBox" style="margin-top:12px; display:none;">
    <div class="label">Вставленное изображение:</div>

    <img
      id="imgPreview"
      alt="preview"
      style="max-width:100%; border-radius:12px; display:block; margin-top:8px;"
    />

    <button
      type="button"
      class="btn btn--wide"
      id="imgRemoveBtn"
      style="margin-top:10px;"
    >
      Удалить изображение
    </button>

    <div class="fineprint" style="margin-top:8px;">
      Подсказка: можно вставить скриншот (Ctrl+V) прямо в поле описания.
    </div>
  </div>
</div>

                <button class="btn btn--primary btn--wide" type="submit" id="tnvedBtn">
                  Подобрать код
                </button>

                <div id="tnvedStatus" class="fineprint" style="margin-top:10px;"></div>

                <div id="tnvedResult" class="card" style="margin-top:14px; display:none;">
                  <div class="keyval"><div class="key">Предполагаемый код ТН ВЭД:</div><div class="val" id="rCode">—</div></div>
                  <div class="keyval"><div class="key">Основание для этого кода:</div><div class="val" id="rReason">—</div></div>
                  <div class="keyval"><div class="key">Вероятность правильности кода:</div><div class="val" id="rProb">—</div></div>
                  <div class="keyval"><div class="key">Необходимо уточнить характеристики:</div><div class="val" id="rQuestions">—</div></div>
                </div>
              </form>

              <div class="fineprint" style="margin-top:12px;">
                Примечание: результат носит справочный характер. Для спорных случаев требуется анализ документов и характеристик товара.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </main>

  <footer class="footer">
    <div class="container footer__inner">
      <div>© <span class="js-year"></span> «ВЭД Суппорт». Мир открыт.</div>
      <div>vedsupport.com</div>
    </div>
  </footer>  
<script>
  // год в футере
  document.querySelectorAll(".js-year").forEach(el => {
    el.textContent = new Date().getFullYear();
  });

  const form = document.getElementById("tnvedForm");
  const statusEl = document.getElementById("tnvedStatus");
  let pastedImageDataUrl = null;

  const textarea = document.getElementById("goodsText");
  const imgBox = document.getElementById("imgBox");
  const imgPreview = document.getElementById("imgPreview");
  const imgRemoveBtn = document.getElementById("imgRemoveBtn");

  textarea.addEventListener("paste", (e) => {
    const items = (e.clipboardData || window.clipboardData)?.items;
    if (!items) return;

    for (const it of items) {
      if (it.type && it.type.startsWith("image/")) {
        e.preventDefault();

        const file = it.getAsFile();
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          pastedImageDataUrl = reader.result;
          imgPreview.src = pastedImageDataUrl;
          imgBox.style.display = "block";
          statusEl.textContent = "Изображение вставлено. Можно нажимать «Подобрать код».";
        };
        reader.readAsDataURL(file);

        return;
      }
    }
  });

  imgRemoveBtn.addEventListener("click", () => {
    pastedImageDataUrl = null;
    imgPreview.src = "";
    imgBox.style.display = "none";
    statusEl.textContent = "Изображение удалено.";
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const btn = document.getElementById("tnvedBtn");
    const text = document.getElementById("goodsText").value.trim();

    if (!text && !pastedImageDataUrl) {
  statusEl.textContent = "Введите описание товара или вставьте изображение.";
  return;
}

    btn.disabled = true;
    statusEl.textContent = "Идёт подбор кода...";
    document.getElementById("mainLogo").classList.add("logo-loading");

    try {
      const response = await fetch("https://api.vedsupport.com/web/classify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ description: text, image_base64: pastedImageDataUrl })
      });

      if (!response.ok) throw new Error("Ошибка сервера");

      const data = await response.json();

      document.getElementById("rCode").textContent = data.tnved_code || "Не определён";
      document.getElementById("rReason").textContent = data.rationale || "—";
      document.getElementById("rProb").textContent = (data.probability ?? "—") + " %";

      if (data.questions && data.questions.length > 0) {
        document.getElementById("rQuestions").textContent = data.questions.join("; ");
      } else {
        document.getElementById("rQuestions").textContent = "Дополнительные уточнения не требуются";
      }

      document.getElementById("tnvedResult").style.display = "block";
      statusEl.textContent = "";

    } catch (err) {
      statusEl.textContent = "Ошибка запроса. Попробуйте позже.";
    } finally {
      document.getElementById("mainLogo").classList.remove("logo-loading");
      btn.disabled = false;
    }
  });
</script>

</body>
</html>